<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<polymer-element name="hero-details" attributes="hero page">
  <template>
    <style>
      table {
        width: 40%;
        border: none;
        float: left;
      }
      .popup {
        width: 100%;
        position: absolute;
        height: 300px;
      }
      .map {
        width: 50%;
        height: 100%;
        position: absolute;
        left: 40%;
      }
    </style>
    <div id='dpopup' class='popup' horizontal layout>
     <table id='dform'>
        <tr>
          <td colspan='2'>Superhero Details</td>
          <td><a on-tap="{{edit}}" href='javascript:'>Edit</a></td>
        </tr>
        <tr>
          <td><div class='picture'>Picture</div></td>
          <td><div>{{hero.name}}, a.k.a.</div><div>{{hero.heroname}}</div></td>
          <td><button>Call Hero</button></td>
        </tr>
        <tr>
          <td>Vitals</td>
          <td><div>{{hero.vitals.heart[0]}}</div><div>Heart rate</div></td>
          <td><div>{{hero.vitals.coffee[0]}}</div><div>Caffeine</div></td>
        </tr>
        <tr>
          <td>IQ</td>
          <td colspan='2'>{{hero.iq}}</td>
        </tr>
        <tr>
          <td>Height</td>
          <td colspan='2'>{{hero.height}} cm</td>
        </tr>
        <tr>
          <td>Weight</td>
          <td colspan='2'>{{hero.weight}} kg</td>
        </tr>
        <tr>
          <td>Kill count</td>
          <td colspan='2'>{{hero.killcount}}</td>
        </tr>
        <tr>
          <td>Arch-enemy</td>
          <td colspan='2'>{{hero.archenemy}}</td>
        </tr>
        <tr>
          <td>Mission</td>
          <td colspan='2'>{{hero.mission}}</td>
        </tr>
        <tr>
          <td colspan='3'><a on-tap="{{close}}" href='javascript:'>Close</a></td>
        </tr>
     </table>
     <div id='dmap' class='map'>
      <google-map id='gdmap' zoom="10" fit>
        <google-map-marker id='gdmark' title="{{hero.name}}" latitude="{{hero.location.latitude}}" longitude="{{hero.location.longitude}}"  draggable="false">{{hero.name}}</google-map-marker>
      </google-map>
     </div>
  </template>
  <script>
    (function () {
      Polymer({
        ready: function() {
        },
        pageChanged: function() {
          if (this.page == 1 && this.hero) {
            // This centers the map at the marker
            this.$.gdmap.fitToMarkers = true;
            // This refreshes the view, otherwise only few map squares are displayed
            this.$.dmap.removeChild(this.$.gdmap);
            this.$.dmap.appendChild(this.$.gdmap);
            // This allows the user move the map
            this.$.gdmap.fitToMarkers = false;
          }
        },
        close: function() {
          this.page = 0;
        },
        edit: function() {
          this.page = 2;
        }
      });
    })();
  </script>
</polymer-element>
