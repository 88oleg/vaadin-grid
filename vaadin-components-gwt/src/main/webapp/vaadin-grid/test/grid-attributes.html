<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <script src="common.js" />
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>

  <link rel="import" href="../vaadin-grid.html">
</head>
<body>

<div id="gridwrapper"></div>

<script>
  describe('attributes', function() {
    function setSelectionMode(mode) {
      grid.setAttribute('selection-mode', mode);
    };

    function setSelectedRows(rows) {
      grid.setAttribute('selected-rows', rows);
    };

    beforeEach(function(done) {
      waitUntilGridReady(grid, function() {
        initializeGrid(done);
      });
    });

    describe('selection-mode', function() {
      it('should set selectionMode to none', function() {
        setSelectionMode('none');

        expect(grid.selectionMode).to.equal('none');
      });

      it('should set selectionMode to single', function() {
        setSelectionMode('single');

        expect(grid.selectionMode).to.equal('single');
      });

      it('should set selectionMode to multi', function() {
        setSelectionMode('multi');

        expect(grid.selectionMode).to.equal('multi');
      });

      it('should should remove selectionMode property', function() {
        setSelectionMode('none');
        grid.removeAttribute('selection-mode');

        // 'single' is the default
        expect(grid.selectionMode).to.equal('single');
      });

      // TODO: throws an error, but for some reason expect doesn't catch it.
      it.skip('should fail setting the value to foobar', function() {
        expect(function() {
          setSelectionMode('foobar');
        }).to.throw(Object);
      });
    });

    describe('selected-rows', function() {
      describe('with mode: single', function() {
        beforeEach(function() {
          setSelectionMode('single');
        });

        it('should set a single value to selectedRows', function() {
          setSelectedRows('0');

          expect(grid.selectedRows).to.contain(0);
        });

        it('should set the last value to selectedRows', function() {
          setSelectedRows('0,1');

          expect(grid.selectedRows).to.contain(1);
        });

        it('should set empty to selectedRows when setting empty value', function() {
          setSelectedRows('0');

          setSelectedRows('');

          expect(grid.selectedRows).to.be.empty;
        });

        // TODO: https://github.com/vaadin/components/issues/3
        it.skip('should set empty to selectedRows when removing attribute', function() {
          setSelectedRows('0');

          grid.removeAttribute('selected-rows');

          expect(grid.selectedRows).to.be.empty;
        });
      });

      describe('with selection-mode: multi', function() {
        beforeEach(function() {
          setSelectionMode('multi');
        });

        it('should set a single value to selectedRows', function() {
          setSelectedRows('1');

          expect(grid.selectedRows).to.include(1);
        });

        it('should set multiple values to selectedRows', function() {
          setSelectedRows('0 , 1');

          expect(grid.selectedRows).to.include.members([0,1]);
        });

        it('should set empty to selectedRows', function() {
          setSelectedRows('');

          expect(grid.selectedRows).to.be.empty;
        });

        it('should leave out invalid values', function() {
          setSelectedRows('1, foobar, 0');

          expect(grid.selectedRows).to.include.members([0,1]);
          expect(grid.selectedRows).to.not.include('foobar');
        });
      });
    });
  });
</script>
</body>
</html>