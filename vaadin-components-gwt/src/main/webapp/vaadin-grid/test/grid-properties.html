<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <script src="common.js" />
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>

  <link rel="import" href="../vaadin-grid.html">
</head>
<body>

<div id="gridwrapper"></div>

<script>
  describe('properties', function() {
    beforeEach(function(done) {
      waitUntilGridReady(grid, function() {
        initializeGrid(done);
      });
    });

    function getSelectionMode() {
      return grid.getAttribute('selection-mode');
    };

    function getSelectedRows() {
      return grid.getAttribute('selected-rows');
    };

    describe('selectionMode', function() {
      var checkBoxQuery = "input[type='checkbox']";

      it('should be single by default', function() {
        expect(grid.selectionMode).to.equal('single');
      });

      it('should be use default value when removing the value', function() {
        grid.selectionMode = 'none';

        grid.selectionMode = undefined;

        expect(grid.selectionMode).to.equal('single');
      });

      it('should set selection-mode to none', function() {
        grid.selectionMode = 'none';

        expect(getSelectionMode()).to.equal('none');
        expect(qLocal(checkBoxQuery)).to.be.undefined;
      });

      it('should set selection-mode to single', function() {
        grid.selectionMode = 'single';

        expect(getSelectionMode()).to.equal('single');
        expect(qLocal(checkBoxQuery)).to.be.undefined;
      });

      it('should set selection-mode to multi', function() {
        grid.selectionMode = 'multi';

        expect(getSelectionMode()).to.equal('multi');
        expect(qLocal(checkBoxQuery)).to.not.be.undefined;
      });

      it('should fail setting the value to foobar', function() {
        expect(function() {
          grid.selectionMode = 'foobar';
        }).to.throw(Object);
      });
    });

    describe('selectedRows', function() {
      it('should add \'row-selected\' class to the selected row', function() {
        grid.selectedRows = [1];

        expect(qaLocal('.v-grid-body .v-grid-row-selected')).to.have.length(1);
      });

      it('should fire \'select\' event', function() {
        var spy = sinon.spy();
        grid.addEventListener('select', spy);

        grid.selectedRows = [0];

        expect(spy.args[0][0]).to.have.property('type', 'select');
      });

      describe('with mode: single', function() {
        beforeEach(function() {
          grid.selectionMode = 'single';
        });

        it('should set a single value to selected-rows', function() {
          grid.selectedRows = [1];

          expect(getSelectedRows()).to.equal('1');
        });

        it('should set the last value from an array to selected-rows', function() {
          grid.selectedRows = [0,1];

          expect(getSelectedRows()).to.equal('1');
        });

        it('should clear the selected-rows value when given an invalid row', function() {
          grid.selectedRows = [1];

          grid.selectedRows = 'foobar';

          expect(getSelectedRows()).to.equal('');
        });
      });

      describe('with selectionMode: multi', function() {
        beforeEach(function () {
          grid.selectionMode = 'multi';
        });

        it('should set a single value to selection-mode', function() {
          grid.selectedRows = [1];

          expect(getSelectedRows()).to.equal('1');
        });

        it('should set multiple values to selection-mode', function() {
          grid.selectedRows = [0,1];

          expect(getSelectedRows()).to.equal('0,1');
        });

        // TODO: https://github.com/vaadin/components/issues/2
        it.skip('should remove selection-mode when set to undefined', function() {
          grid.selectedRows = [0];

          grid.selectedRows = undefined;

          expect(grid.getAttribute('selected-rows')).to.be.undefined;
        });

        it('should set selection-mode to empty', function() {
          grid.selectedRows = [0];

          grid.selectedRows = [];

          expect(getSelectedRows()).to.be.empty;
        });

        it('should fire a \'select\' event', function() {
          var spy = sinon.spy();
          grid.addEventListener('select', spy);

          grid.selectedRows = [0,1];

          expect(spy.calledOnce).to.be.true;
        });
      });
    });
  });
</script>
</body>
</html>